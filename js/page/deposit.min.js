function xxx(){$.ajax({type:"GET",url:contextPath+cVersion+"/xxx/xxx",dataType:"json",cache:!1,beforeSend:function(){},success:function(data){isSuccess(data)},error:function(data){unblockPage()}})}function verifyDeposit(){$.ajax({type:"GET",url:contextPath+cVersion+"/Deposit/Check/WaitApprove",dataType:"json",cache:!1,beforeSend:function(){blockPage()},success:function(data){isSuccess(data)?DepositForm2Fill():notify(data),unblockPage()},error:function(data){unblockPage()}})}function DepositForm2Fill(){var jsonData=$("#form-action-amount-deposit").serialize();$.ajax({type:"POST",url:contextPath+cVersion+"/Deposit/Form2Fill",data:jsonData,dataType:"json",cache:!1,beforeSend:function(){blockPage()},success:function(data){isSuccess(data)&&$("#amountDeposit").val(""),notify(data),unblockPage()},error:function(data){unblockPage()}})}function CheckTxDeposit(){$("#depositWithdraw").modal("hide"),$.ajax({type:"GET",url:contextPath+cVersion+"/Deposit/Check/WaitApprove",dataType:"json",cache:!1,beforeSend:function(){},success:function(data){var res=data;isSuccess(data)?($(".select-promotion-list").removeClass("d-none"),$("#btn-deposit-amt").removeAttr("disabled"),$("#btn-deposit-amt").html(L.btn.notifyDpAmount)):($("#btn-deposit-amt").attr("disabled","disabled"),$("#btn-deposit-amt").html(res.statusDesc)),InquiryDepositType()},error:function(data){unblockPage()}})}function InquiryDepositType(){$.ajax({type:"GET",url:contextPath+cVersion+"/Deposit/Inquiry/type",dataType:"json",cache:!1,beforeSend:function(){blockPage()},success:function(data){if(isSuccess(data)){var res=data.data;htmlPormotionAT(res),"A"==res.type?($(".btn-dp").addClass("d-none"),$(".btn-dp-auto").removeClass("d-none"),$("#amountDeposit").addClass("d-none"),$("#btn-deposit-amt").addClass("d-none"),$("#autoDeposit").modal("show")):($(".btn-dp").removeClass("d-none"),$(".btn-dp-auto").addClass("d-none"),$("#amountDeposit").removeClass("d-none"),$("#btn-deposit-amt").removeClass("d-none"),$("#autoDeposit").modal("show"))}},error:function(data){}})}function htmlPormotionAT(data){if(""!=data){var html="";null!=data.current&&$.each(data.promotionList,(function(k,v){v.key==data.current.s_prm_code&&(document.getElementById("prmText_AT").textContent=v.value,document.getElementById("prmCode_AT").value=v.key)})),html+="<li>",html+='<a class="dropdown-item px-2 d-flex cursor-pointer align-items-center gap-2" ',html+="onclick=\"changeDropdownPrmAT('-1','"+L.lb.dontPrm+"')\">",html+=L.lb.dontPrm,html+="</a>",html+="</li>",$.each(data.promotionList,(function(k,v){html+="<li>",html+='<a class="dropdown-item px-2 d-flex cursor-pointer align-items-center gap-2" ',html+="onclick=\"changeDropdownPrmAT('"+v.key+"','"+v.value+"')\">",html+=v.value,html+="</a>",html+="</li>"})),$("#promotion-list-at").html(html)}}function changeDropdownPrmAT(key,text){toggleDDLmenu(".select-promotion-list"),$.ajax({type:"POST",url:contextPath+cVersion+"/Deposit/Promotion/Select",data:{key:key,s_type:"AUTO"},dataType:"json",cache:!1,beforeSend:function(){blockPage()},success:function(data){isSuccess(data)&&(document.getElementById("prmText_AT").textContent=text,document.getElementById("prmId_AT").value=key),notify(data)},error:function(data){}})}function changeBankDeposit(Id,bankNo,bankNoFormat,accName,color,img,BankName){$("#i_bank_agent").val(Id),$(".ddl-btn-deposit").css("background",color),$("#bank-deposit-img").attr("src","./assets/images/bankName/"+img),$("#bank-deposit-name").html(BankName),$("#s_account_no").val(bankNo),$("#bankAccount").val(bankNoFormat),$("#bank-deposit-acc-name").html(accName)}function changeBankDepositSlip(Id,bankNo,bankNoFormat,accName,color,img,BankName){$("#i_bank_agent_slip").val(Id),$(".ddl-btn-deposit-slip").css("background",color),$("#bank-deposit-img-slip").attr("src","./assets/images/bankName/"+img),$("#bank-deposit-name-slip").html(BankName),$("#s_account_no_slip").val(bankNo),$("#bankAccountSlip").val(bankNoFormat),$("#bank-deposit-acc-name-slip").html(accName)}function changeBankWD(Id,bankNo,bankNoFormat,accName,color,img,BankName){$("#i_bank").html(Id),$(".ddl-btn-wd").css("background",color),$("#bank-wd-img").attr("src","./assets/images/bankName/"+img),$("#bank-wd-name").html(BankName),$("#dw_account_no").val(bankNo),$("#bankAccountWD").val(bankNoFormat),$("#bank-wd-acc-name").html(accName)}function changeTw(Id,bankNo,bankNoFormat,accName,color,img,BankName){$("#i_bank_agent_tw").html(Id),$(".ddl-btn-deposit-tw").css("background",color),$("#bank-deposit-img-tw").attr("src","./assets/images/bankName/"+img),$("#bank-deposit-name-ts").html(BankName),$("#s_account_no-ts").val(bankNo),$("#bankAccountTw").val(bankNoFormat),$("#bank-deposit-acc-name-tw").html(accName)}function callmodalDeposit(){$(".elm-deposit").addClass("d-none"),$.ajax({type:"GET",url:contextPath+cVersion+"/Deposit/Inquiry/type",dataType:"json",cache:!1,beforeSend:function(){blockPage()},success:function(data){if(isSuccess(data)){var res=data.data;htmlPormotionAT(res),"A"==res.type||"S"==res.type?$("#d-auto").removeClass("d-none"):"U"==res.type&&($("#d-slip").removeClass("d-none"),$("#btn-slip").removeClass("d-none")),$("#depositWithdraw").modal("show")}},error:function(data){}})}async function uploadFile(){const fileInput=document.getElementById("fileslip"),file=fileInput.files[0],_URL=window.URL||window.webkitURL;var img;const slip=await uploadSlip(_URL.createObjectURL(file))}async function uploadSlip(url){let imgData=null;const minScale=.75,maxScale=5,step=.25;let currentScale=.75;do{imgData=await addImageProcess(url,currentScale),currentScale+=.25}while(null===imgData&&currentScale<=5);document.getElementById("fileslip").value="",null!=imgData?$.ajax({type:"POST",url:contextPath+cVersion+"/Deposit/UploadSlip",data:{qr:imgData.data,i_bank_agent:$("#i_bank_agent").val(),s_prm_code:$("#prmCode_AT").val()},dataType:"json",cache:!1,beforeSend:function(){},success:function(data){isSuccess(data),notify(data)},error:function(data){}}):notify(data)}async function addImageProcess(src,scale){return new Promise((resolve,reject)=>{let img=new Image;img.onload=function(){const canvas=document.createElement("canvas");canvas.width=Math.floor(img.width*scale),canvas.height=Math.floor(img.height*scale);const ctx=canvas.getContext("2d");ctx.fillStyle="white",ctx.fillRect(0,0,canvas.width,canvas.height),ctx.drawImage(img,0,0,canvas.width,canvas.height);let imgData=ctx.getImageData(0,0,ctx.canvas.width,ctx.canvas.height),pixels=imgData.data;for(var i=0;i<pixels.length;i+=4){let lightness=parseInt((pixels[i]+pixels[i+1]+pixels[i+2])/3);pixels[i]=lightness,pixels[i+1]=lightness,pixels[i+2]=lightness}ctx.putImageData(imgData,0,0);let imageData=ctx.getImageData(0,0,canvas.width,canvas.height);const code=jsQR(imageData.data,canvas.width,canvas.height);resolve(code)},img.onerror=reject,img.src=src})}$(document).ready((function(){})),$("#funcDeposit").on("shown.bs.modal",(function(){$(".select-promotion-list").removeClass("show")}));